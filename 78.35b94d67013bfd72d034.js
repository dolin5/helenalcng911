(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/2d/layers/BitmapLayerView2D":762,"esri/views/2d/layers/support/ExportStrategy":763,"esri/views/2d/viewStateUtils":764,"esri/views/2d/layers/MapImageLayerView2D":1497,"esri/views/layers/MapImageLayerView":1498})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{1497:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(7),r(1),r(0),r(6),r(8),r(9),r(4),r(14),r(2),r(977),r(762),r(637),r(763),r(796),r(627),r(1498),r(293)],void 0===(o=function(e,t,r,i,o,a,n,p,s,u,c,l,d,h,m,y,g,f,v){var x=p.getLogger("esri.views.2d.layers.MapImageLayerView2D");return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._exportImageParameters=null,t._exportImageVersion=-1,t}return i(t,e),t.prototype.hitTest=function(e,t){return null},t.prototype.update=function(e){this.strategy.update(e)},t.prototype.attach=function(){var e=this,t=this.layer,r=t.imageMaxWidth,i=t.imageMaxHeight,o=t.version,a=o>=10.3,n=o>=10;this.strategy=new m({container:this.container,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:r,imageMaxHeight:i,imageRotationSupported:a,imageNormalizationSupported:n,hidpi:!0}),this._exportImageParameters=new l.ExportImageParameters({view:this.view,layer:this.layer}),this.handles.add(u.init(this._exportImageParameters,"version",(function(t){e._exportImageVersion!==t&&(e._exportImageVersion=t,e.requestUpdate())})),"mapimagelayerview-update")},t.prototype.detach=function(){this.strategy.destroy(),this.handles.remove("mapimagelayerview-update"),this._exportImageParameters.layer=null,this._exportImageParameters.destroy(),this._exportImageParameters=null,this._exportImageVersion=-1,this.container.removeAllChildren()},t.prototype.moveStart=function(){},t.prototype.viewChange=function(){},t.prototype.moveEnd=function(){this.requestUpdate()},t.prototype.createFetchPopupFeaturesQueryGeometry=function(e,t){return y.createQueryGeometry(e,t,this.view)},t.prototype.doRefresh=function(e){return n(this,void 0,void 0,(function(){return a(this,(function(e){return this.requestUpdate(),[2]}))}))},t.prototype.isUpdating=function(){return this.attached&&(this.strategy.updating||this.updateRequested)},t.prototype.fetchImage=function(e,t,i,o){return o=r({timeExtent:this._exportImageParameters.timeExtent,timestamp:this.refreshTimestamp},o),this.layer.fetchImage(e,t,i,o).catch((function(e){return s.isAbortError(e)||x.error(e),s.reject(e)}))},o([c.property()],t.prototype,"strategy",void 0),o([c.property({dependsOn:["strategy.updating"]})],t.prototype,"updating",void 0),o([c.subclass("esri.views.2d.layers.MapImageLayerView2D")],t)}(c.declared(f.MapImageLayerView(v.RefreshableLayerView(d.BitmapLayerView2D(h.LayerView2D(g))))))}.apply(null,i))||(e.exports=o)},1498:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(1),r(0),r(6),r(8),r(11),r(4),r(2),r(794)],void 0===(o=function(e,t,r,i,o,a,n,p,s,u){Object.defineProperty(t,"__esModule",{value:!0}),t.MapImageLayerView=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.fetchPopupFeatures=function(e){return a(this,void 0,void 0,(function(){var t,r,i,s,c,l=this;return o(this,(function(d){switch(d.label){case 0:return t=this.layer,e?(r=this.get("view.scale"),i=[],s=function(e){var t=0===e.minScale||r<=e.minScale,o=0===e.maxScale||r>=e.maxScale;e.visible&&t&&o&&(e.sublayers?e.sublayers.forEach(s):e.popupTemplate&&e.popupEnabled&&i.push(e))},t.sublayers.forEach(s),c=i.map((function(t){return a(l,void 0,void 0,(function(){var r,i,a;return o(this,(function(o){switch(o.label){case 0:return[4,t.popupTemplate.getRequiredFields()];case 1:return r=o.sent(),i=t.createQuery(),a=u.calculateTolerance(t.renderer),i.geometry=this.createFetchPopupFeaturesQueryGeometry(e,a),i.outFields=r,[4,t.queryFeatures(i)];case 2:return[2,o.sent().features]}}))}))})),[4,p.eachAlways(c)]):[2,p.reject(new n("mapimagelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:t}))];case 1:return[2,d.sent().reduce((function(e,t){return e.concat(t.value)}),[]).filter((function(e){return null!=e}))]}}))}))},i([s.property()],t.prototype,"layer",void 0),i([s.subclass("esri.views.layers.MapImageLayerView")],t)}(s.declared(e))}}.apply(null,i))||(e.exports=o)},762:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(0),r(1),r(2),r(777)],void 0===(o=function(e,t,r,i,o,a){Object.defineProperty(t,"__esModule",{value:!0}),t.BitmapLayerView2D=function(e){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.container=new a.BitmapContainer(t.clips),t}return i(t,e),t.prototype.initialize=function(){var e=this;this.handles.add(this.clips.on("change",(function(){return e.container.setClips(e.clips)})))},r([o.subclass("esri.views.2d.layers.BitmapLayerView2D")],t)}(o.declared(e))}}.apply(null,i))||(e.exports=o)},763:function(e,t,r){var i,o;i=[r.dj.c(e.i),t,r(7),r(6),r(8),r(1),r(0),r(10),r(4),r(2),r(30),r(170),r(38),r(176),r(561),r(764),r(294),r(91)],void 0===(o=function(e,t,r,i,o,a,n,p,s,u,c,l,d,h,m,y,g,f){var v=l.create(),x=[0,0],w=new f(0,0,0,0),M={container:null,fetchSource:null,requestUpdate:null,imageMaxWidth:2048,imageMaxHeight:2048,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1};return function(e){function t(t){var r=e.call(this,t)||this;return r._imagePromise=null,r.hidpi=M.hidpi,r.imageMaxWidth=M.imageMaxWidth,r.imageMaxHeight=M.imageMaxHeight,r.imageRotationSupported=M.imageRotationSupported,r.imageNormalizationSupported=M.imageNormalizationSupported,r.update=s.debounce((function(e){return o(r,void 0,void 0,(function(){var t,r,o,a,n,p,u,c,l,h=this;return i(this,(function(i){return t=e.state,r=d.getInfo(t.spatialReference),o=this.hidpi?e.pixelRatio:1,!e.stationary||this.destroyed?[2]:(this.imageRotationSupported?(x[0]=t.size[0],x[1]=t.size[1]):y.getOuterSize(x,t),a=Math.floor(x[0]*o)>this.imageMaxWidth||Math.floor(x[1]*o)>this.imageMaxHeight,n=r&&(t.extent.xmin<r.valid[0]||t.extent.xmax>r.valid[1]),p=!this.imageNormalizationSupported&&n,u=!a&&!p,c=this.imageRotationSupported?t.rotation:0,u?this._imagePromise=this._singleExport(t,x,c,o):(l=Math.min(this.imageMaxWidth,this.imageMaxHeight),p&&(l=Math.min(t.worldScreenWidth,l)),this._imagePromise=this._tiledExport(t,l,c,o)),[2,this._imagePromise.then((function(e){h._imagePromise=null;var t=h.container.children.slice();h.container.removeAllChildren(),e.forEach(h.container.addChild,h.container),h.disposeSource&&t.forEach((function(e){h.disposeSource(e.source)}),h)})).catch((function(e){if(h._imagePromise=null,!s.isAbortError(e))throw e}))])}))}))})),r}return a(t,e),t.prototype.destroy=function(){},Object.defineProperty(t.prototype,"updating",{get:function(){return null!==this._imagePromise},enumerable:!0,configurable:!0}),t.prototype.updateExports=function(e){for(var t=0,r=this.container.children;t<r.length;t++){var i=r[t];if(!i.visible||!i.attached)return;e(i)?console.error("ExportStrategy.updateExports doesn't support promise yet"):(i.invalidateTexture(),i.requestRender())}},t.prototype._export=function(e,t,r,i,o){var a=this;return s.resolve().then((function(){return a.fetchSource(e,Math.floor(t*o),Math.floor(r*o),{rotation:i,pixelRatio:o})})).then((function(r){var a=new m.Bitmap(r);return a.x=e.xmin,a.y=e.ymax,a.resolution=e.width/t,a.rotation=i,a.pixelRatio=o,a}))},t.prototype._singleExport=function(e,t,r,i){y.getBBox(v,e.center,e.resolution,t);var o=new c(v[0],v[1],v[2],v[3],e.spatialReference);return this._export(o,t[0],t[1],r,i).then((function(e){return[e]}))},t.prototype._tiledExport=function(e,t,r,i){var o=this,a=h.create({size:t,spatialReference:e.spatialReference,scales:[e.scale]}),n=new g(a),p=n.getTileCoverage(e);if(!p)return null;var u=[];return p.forEach((function(a,p,s,l){w.set(a,p,s,l),n.getTileBounds(v,w);var d=new c(v[0],v[1],v[2],v[3],e.spatialReference);u.push(o._export(d,t,t,r,i))})),s.all(u)},n([u.property()],t.prototype,"_imagePromise",void 0),n([u.property()],t.prototype,"container",void 0),n([u.property()],t.prototype,"disposeSource",void 0),n([u.property()],t.prototype,"fetchSource",void 0),n([u.property()],t.prototype,"hidpi",void 0),n([u.property()],t.prototype,"imageMaxWidth",void 0),n([u.property()],t.prototype,"imageMaxHeight",void 0),n([u.property()],t.prototype,"imageRotationSupported",void 0),n([u.property()],t.prototype,"imageNormalizationSupported",void 0),n([u.property()],t.prototype,"requestUpdate",void 0),n([u.property({dependsOn:["_imagePromise"]})],t.prototype,"updating",null),n([u.subclass("esri.views.2d.layers.support.ExportStrategy")],t)}(u.declared(p))}.apply(null,i))||(e.exports=o)},764:function(e,t,r){var i,o;i=[r.dj.c(e.i),t],void 0===(o=function(e,t){function r(e){return e*i}Object.defineProperty(t,"__esModule",{value:!0});var i=Math.PI/180;t.snapToPixel=function(e,t,r){var i=r.resolution,o=r.size;return e[0]=i*(Math.round(t[0]/i)+o[0]%2*.5),e[1]=i*(Math.round(t[1]/i)+o[1]%2*.5),e},t.getOuterSize=function(e,t){var i=r(t.rotation),o=Math.abs(Math.cos(i)),a=Math.abs(Math.sin(i)),n=t.size,p=n[0],s=n[1];return e[0]=Math.round(s*a+p*o),e[1]=Math.round(s*o+p*a),e},t.getBBox=function(e,t,r,i){var o=t[0],a=t[1],n=i[0],p=i[1],s=.5*r;return e[0]=o-s*n,e[1]=a-s*p,e[2]=o+s*n,e[3]=a+s*p,e},t.bboxIntersects=function(e,t){var r=e[0],i=e[1],o=e[2],a=e[3],n=t[0],p=t[1],s=t[2],u=t[3];return!(r>s||o<n||i>u||a<p)}}.apply(null,i))||(e.exports=o)}}]);